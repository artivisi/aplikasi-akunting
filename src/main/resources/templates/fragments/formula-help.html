<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="id">
<body>
    <!-- Formula Help Panel - Include with th:replace="fragments/formula-help :: formula-help" -->
    <div th:fragment="formula-help" x-data="{ open: false, activeTab: 'syntax' }" class="mt-4">
        <button @click="open = !open" type="button"
                class="flex items-center text-sm text-primary-600 hover:text-primary-800 transition-colors">
            <svg class="w-4 h-4 mr-2" :class="{ 'rotate-90': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            Bantuan Formula
        </button>

        <div x-show="open" x-collapse class="mt-3 bg-blue-50 rounded-lg border border-blue-200 overflow-hidden">
            <!-- Tab Navigation -->
            <div class="flex border-b border-blue-200 bg-blue-100">
                <button @click="activeTab = 'syntax'" type="button"
                        :class="activeTab === 'syntax' ? 'bg-blue-50 text-blue-800 border-b-2 border-blue-600' : 'text-blue-600 hover:bg-blue-50'"
                        class="px-4 py-2 text-sm font-medium transition-colors">
                    Sintaks
                </button>
                <button @click="activeTab = 'examples'" type="button"
                        :class="activeTab === 'examples' ? 'bg-blue-50 text-blue-800 border-b-2 border-blue-600' : 'text-blue-600 hover:bg-blue-50'"
                        class="px-4 py-2 text-sm font-medium transition-colors">
                    Contoh Skenario
                </button>
            </div>

            <!-- Syntax Tab -->
            <div x-show="activeTab === 'syntax'" class="p-4">
                <h4 class="text-sm font-semibold text-blue-800 mb-3">Referensi Sintaks Formula</h4>

                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead>
                            <tr class="border-b border-blue-200">
                                <th class="text-left py-2 pr-4 text-blue-700">Elemen</th>
                                <th class="text-left py-2 pr-4 text-blue-700">Contoh</th>
                                <th class="text-left py-2 text-blue-700">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody class="text-blue-800">
                            <tr class="border-b border-blue-100">
                                <td class="py-2 pr-4 font-medium">Variable</td>
                                <td class="py-2 pr-4 font-mono bg-white px-2 rounded">amount</td>
                                <td class="py-2">Nilai transaksi yang diinput user</td>
                            </tr>
                            <tr class="border-b border-blue-100">
                                <td class="py-2 pr-4 font-medium">Perkalian</td>
                                <td class="py-2 pr-4 font-mono bg-white px-2 rounded">amount * 0.11</td>
                                <td class="py-2">Hitung persentase (11%)</td>
                            </tr>
                            <tr class="border-b border-blue-100">
                                <td class="py-2 pr-4 font-medium">Pembagian</td>
                                <td class="py-2 pr-4 font-mono bg-white px-2 rounded">amount / 1.11</td>
                                <td class="py-2">Ekstrak DPP dari gross</td>
                            </tr>
                            <tr class="border-b border-blue-100">
                                <td class="py-2 pr-4 font-medium">Pengurangan</td>
                                <td class="py-2 pr-4 font-mono bg-white px-2 rounded">amount - 320000</td>
                                <td class="py-2">Kurangi nilai tetap</td>
                            </tr>
                            <tr class="border-b border-blue-100">
                                <td class="py-2 pr-4 font-medium">Kondisional</td>
                                <td class="py-2 pr-4 font-mono bg-white px-2 rounded text-[10px]">amount > 2000000 ? amount * 0.02 : 0</td>
                                <td class="py-2">Jika kondisi terpenuhi</td>
                            </tr>
                            <tr>
                                <td class="py-2 pr-4 font-medium">Konstanta</td>
                                <td class="py-2 pr-4 font-mono bg-white px-2 rounded">320000</td>
                                <td class="py-2">Nilai tetap</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 p-3 bg-amber-50 rounded border border-amber-200">
                    <p class="text-xs text-amber-800">
                        <span class="font-semibold">Catatan:</span> Gunakan format desimal untuk persentase.
                        Contoh: 11% ditulis <code class="bg-white px-1 rounded">0.11</code>, bukan <code class="bg-white px-1 rounded">11%</code>
                    </p>
                </div>
            </div>

            <!-- Examples Tab -->
            <div x-show="activeTab === 'examples'" class="p-4 space-y-4">
                <h4 class="text-sm font-semibold text-blue-800 mb-3">Contoh Skenario</h4>

                <!-- Scenario 1: Simple Sale -->
                <div class="bg-white rounded-lg p-3 border border-blue-100">
                    <h5 class="text-xs font-semibold text-gray-800 mb-2">1. Penjualan Tunai Sederhana</h5>
                    <p class="text-xs text-gray-600 mb-2">Jual jasa Rp 10.000.000, terima tunai</p>
                    <div class="bg-gray-50 rounded p-2 font-mono text-xs">
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-green-700">Debit - Kas/Bank</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Pendapatan</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount</span>
                        </div>
                    </div>
                </div>

                <!-- Scenario 2: Sale with PPN -->
                <div class="bg-white rounded-lg p-3 border border-blue-100">
                    <h5 class="text-xs font-semibold text-gray-800 mb-2">2. Penjualan dengan PPN 11%</h5>
                    <p class="text-xs text-gray-600 mb-2">Jual jasa Rp 11.100.000 (sudah termasuk PPN)</p>
                    <div class="text-xs text-gray-600 mb-2 bg-yellow-50 p-2 rounded">
                        <strong>Perhitungan:</strong><br/>
                        DPP = 11.100.000 / 1.11 = Rp 10.000.000<br/>
                        PPN = 11.100.000 - 10.000.000 = Rp 1.100.000
                    </div>
                    <div class="bg-gray-50 rounded p-2 font-mono text-xs space-y-1">
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-green-700">Debit - Bank</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Pendapatan</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount / 1.11</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - PPN Keluaran</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold text-[10px]">amount - (amount / 1.11)</span>
                        </div>
                    </div>
                </div>

                <!-- Scenario 3: Purchase with PPN -->
                <div class="bg-white rounded-lg p-3 border border-blue-100">
                    <h5 class="text-xs font-semibold text-gray-800 mb-2">3. Pembelian dengan PPN 11%</h5>
                    <p class="text-xs text-gray-600 mb-2">Beli perlengkapan Rp 5.550.000 (sudah termasuk PPN)</p>
                    <div class="bg-gray-50 rounded p-2 font-mono text-xs space-y-1">
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-green-700">Debit - Perlengkapan</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount / 1.11</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-green-700">Debit - PPN Masukan</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold text-[10px]">amount - (amount / 1.11)</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Kas/Bank</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount</span>
                        </div>
                    </div>
                </div>

                <!-- Scenario 4: PPh 23 -->
                <div class="bg-white rounded-lg p-3 border border-blue-100">
                    <h5 class="text-xs font-semibold text-gray-800 mb-2">4. PPh 23 Jasa (2% jika &gt; Rp 2.000.000)</h5>
                    <p class="text-xs text-gray-600 mb-2">Bayar jasa konsultan Rp 5.000.000</p>
                    <div class="text-xs text-gray-600 mb-2 bg-yellow-50 p-2 rounded">
                        <strong>Perhitungan:</strong><br/>
                        PPh 23 = 5.000.000 * 0.02 = Rp 100.000<br/>
                        Dibayar = 5.000.000 - 100.000 = Rp 4.900.000
                    </div>
                    <div class="bg-gray-50 rounded p-2 font-mono text-[10px] space-y-1">
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-green-700">Debit - Beban Jasa</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Kas/Bank</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount - (amount &gt; 2000000 ? amount * 0.02 : 0)</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Hutang PPh 23</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount &gt; 2000000 ? amount * 0.02 : 0</span>
                        </div>
                    </div>
                    <p class="text-[10px] text-gray-500 mt-2 italic">
                        * Jika amount &le; 2.000.000, PPh 23 = 0 (tidak dipotong)
                    </p>
                </div>

                <!-- Scenario 5: Fixed Deduction -->
                <div class="bg-white rounded-lg p-3 border border-blue-100">
                    <h5 class="text-xs font-semibold text-gray-800 mb-2">5. Gaji dengan Potongan Tetap</h5>
                    <p class="text-xs text-gray-600 mb-2">Gaji Rp 8.000.000, potongan BPJS Rp 320.000</p>
                    <div class="bg-gray-50 rounded p-2 font-mono text-xs space-y-1">
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-green-700">Debit - Beban Gaji</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Kas/Bank</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">amount - 320000</span>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <span class="text-red-700">Kredit - Hutang BPJS</span>
                            <span class="text-gray-500">:</span>
                            <span class="font-semibold">320000</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Formula Preview Component - Include with th:replace="fragments/formula-help :: formula-preview" -->
    <div th:fragment="formula-preview" x-data="formulaPreview()" class="mt-2">
        <div class="flex items-center space-x-2">
            <label class="text-xs text-gray-500">Preview dengan:</label>
            <div class="relative">
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-xs text-gray-400">Rp</span>
                <input type="text" x-model="sampleAmount"
                       @input="updatePreview()"
                       class="w-32 pl-7 pr-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-primary-500 focus:border-primary-500 text-right font-mono"
                       placeholder="10.000.000">
            </div>
            <span class="text-xs text-gray-500">=</span>
            <span x-text="previewResult" class="text-xs font-mono font-semibold text-primary-700"></span>
        </div>
        <p x-show="previewError" x-text="previewError" class="text-xs text-red-600 mt-1"></p>
    </div>
</body>
</html>
